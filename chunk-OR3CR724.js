import{A as s,Da as u,Ia as g,Ja as k,c as i,f as c,j as l,ua as h,w as m}from"./chunk-7A3Z4Z4W.js";var I=(()=>{let o=class o{constructor(e,t,a){this.http=e,this.cookies=t,this.router=a,this.apiLogin=this.getBaseUrl()+"/login/authenticate"}login(e){return this.http.post(this.apiLogin,e).pipe(l(t=>(console.error(t.error.message),alert(t.error.message),c("e"))))}register(e){return this.http.post(this.getBaseUrl()+"/account/create",e).pipe(l(t=>(console.error(t.error.message),alert(t.error.message),c("e"))))}getBaseUrl(){return g.production?"https://www.trelloclone.somee.com/api":"/api"}logout(){return i(this,null,function*(){this.cookies.delete("token"),this.cookies.delete("user.email"),this.cookies.delete("user.name"),this.cookies.delete("user.type"),this.cookies.deleteAll(),localStorage.clear(),this.router.navigate(["/login"])})}getToken(){return i(this,null,function*(){return yield this.cookies.get("token")})}isAuth(){return i(this,null,function*(){try{let e=yield this.getToken();return e?!(yield this.isTokenExpired(e))?.expired:!1}catch(e){return console.error("Error al verificar la autenticaci\xF3n:",e),!1}})}isTokenExpired(e){return i(this,null,function*(){let t=e.split(".");return new Promise((a,d)=>{try{let r=JSON.parse(atob(t[1]));this.cookies.set("user.email",r["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress"]),this.cookies.set("user.name",r["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name"]),this.cookies.set("user.type",r.AType);let p=Math.floor(new Date().getTime()/1e3),f=r?.exp-p;a({expired:p>=r?.exp,timeRemaining:f})}catch(r){console.error("Error parsing token payload:",r),d(r)}})})}};o.\u0275fac=function(t){return new(t||o)(s(h),s(k),s(u))},o.\u0275prov=m({token:o,factory:o.\u0275fac,providedIn:"root"});let n=o;return n})();export{I as a};
